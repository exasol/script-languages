#!/usr/bin/env perl

use strict;
use warnings;

use English;
use File::Basename;
use Net::Ping;

sub main() {
    my $program = basename($PROGRAM_NAME);
    my $version = '6.0.8 (rev. gbc/exasol/R6.0.8:8365)';
    my $copyright = 'Copyright (c) 2018 EXASOL AG';
    if ($#ARGV != 1) {
        print STDERR "$program $version\n";
        print STDERR "$copyright\n";
        print STDERR "\n";
        print STDERR "Usage: $program host port\n";
        print STDERR "\n";
        print STDERR "Portable 'ping' using TCP\n";
        exit 2;
    }
    my $host = $ARGV[0];
    my $port = $ARGV[1];
    my $p = Net::Ping->new('tcp');
    $p->service_check(0);
    $p->{port_num} = $port;
    if ($p->ping($host)) {
        print "$host is reachable\n";
        $p->service_check(1);
        if ($p->ping($host)) {
            print "service at port $port is reachable\n";
            return 0;
        } else {
            print "service at port $port is NOT REACHABLE\n";
            return 1;
        }
    } else {
        print "$host is NOT REACHABLE\n";
        return 1;
    }
}

exit main();

# vim: ts=4:sts=4:sw=4:et:ft=perl:fdm=indent
